<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1.0"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><link rel="alternate" href="https://sanbaofengs.com" hreflang="zh-Hans"><meta name="google-site-verification" content="yVLudwcqIQlJbqhCeKLJZ8W_I1OJeVE8p30fz1mRhLM"><meta name="baidu-site-verification" content="lGmVtKnPAU"><meta name="author" content="San Baofeng"><meta name="description" content="If I Rest, I Rust"><link rel="alternative" href="/atom.xml" title="San Baofeng's" type="application/atom+xml"><link rel="icon" href="/img/favicon.ico"><script>var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?" + 'f00d6c21ad53bcc5d93c0a390afc84a7';
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
})();</script><title>Vanilla Tilt 源码阅读总结 - San Baofeng's</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><link rel="stylesheet" href="/js/gitment/gitment-default.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script><script src="/js/gitment/gitment.browser.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">San Baofeng's</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><nav class="post-nav"><a class="nav-item next" href="/2018/05/04/box-size/"><i class="icon-arrow-right"></i><span class="nav-item-title nav-item-title-right">块/行级元素的宽高</span></a></nav><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2018-05-08T11:29:11.000Z">05-08, 2018</time><h1 class="post__title"><a href="/2018/05/08/read-vanillaTilt-code/">Vanilla Tilt 源码阅读总结</a></h1><div class="post__main echo"><h2 id="关于-vanilla-tilt"><a href="#关于-vanilla-tilt" class="headerlink" title="关于 vanilla tilt"></a>关于 vanilla tilt</h2><p><a href="https://micku7zu.github.io/vanilla-tilt.js/" target="_blank" rel="noopener">vanilla-tilt</a> 是一个 3D 倾斜的 JavaScript 库，具有以下特点</p>
<ul>
<li>流畅</li>
<li>轻量级</li>
<li>60FPS</li>
<li>原生 JS</li>
<li>不依赖第三方库</li>
<li>简单易用</li>
</ul>
<p>Ps：详情请参考其<a href="https://micku7zu.github.io/vanilla-tilt.js/" target="_blank" rel="noopener">官网</a></p>
<p>举个栗子</p>
<iframe src="https://sanbaofengs.com/slaughter/js/vanillaTilt/" frameborder="1" scrolling="no"> </iframe>

<p>本文主要记录对 vanilla-tilt 源码阅读的过程</p>
<h2 id="作用域包裹"><a href="#作用域包裹" class="headerlink" title="作用域包裹"></a>作用域包裹</h2><p>老套路，使用 <strong>立即执行函数</strong> 将自己的业务逻辑包裹起来，这么做的好处：</p>
<ul>
<li><strong>避免全局污染</strong>：所有库相关的逻辑，定义的变量，以及使用到的变量，统统封装到该函数作用域中</li>
<li><strong>隐私保护</strong>：但凡在立即执行函数中声明的变量，函数，除非自己想要暴露，否则从外界是不可能获取的</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> VanillaTilt = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// add your logic</span></span><br><span class="line">&#125;())</span><br></pre></td></tr></table></figure>
<h2 id="自动加载-amp-批量初始化"><a href="#自动加载-amp-批量初始化" class="headerlink" title="自动加载 &amp; 批量初始化"></a>自动加载 &amp; 批量初始化</h2><p>核心类采用 ES6 的 <code>class</code> 进行编写，使用类的静态方法 <em>static init (elements, settings)</em>，对元素进行初始化</p>
<h3 id="自动加载"><a href="#自动加载" class="headerlink" title="自动加载"></a>自动加载</h3><p>当加载 <code>vanilla-tilt</code> 库之后，校验是否处在浏览器环境，如果是，则对设置了 <code>data-tilt</code> 属性的元素进行初始化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">document</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="comment">// init</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    VanillaTilt.inti(<span class="built_in">document</span>.querySelectorAll(<span class="string">'[data-tilt]'</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="批量初始化"><a href="#批量初始化" class="headerlink" title="批量初始化"></a>批量初始化</h3><p>在类 VanillaTilt 的静态方法 init 中，优先对元素进行一系列的校验，详情看以下注释</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> init (elements, settings) &#123;</span><br><span class="line">    <span class="comment">// 检测 elements 是否为节点类型</span></span><br><span class="line">    <span class="comment">// 在用户手动调用 init 的时候可能触发</span></span><br><span class="line">    <span class="keyword">if</span> (elements <span class="keyword">instanceof</span> Node) &#123;</span><br><span class="line">        elements = [elements];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 检测 elements 是否是 NodeList</span></span><br><span class="line">    <span class="comment">// 自动加载 || 用户手动调用 init 时触发</span></span><br><span class="line">    <span class="keyword">if</span> (elements <span class="keyword">instanceof</span> NodeList) &#123;</span><br><span class="line">        <span class="comment">// NodeList to Array</span></span><br><span class="line">        elements = [].slice.call(elements);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// elememts 必须为 Array 类型</span></span><br><span class="line">    <span class="comment">// 原因：后续讲调用 Array 有关方法</span></span><br><span class="line">    <span class="keyword">if</span> (!(elements <span class="keyword">instanceof</span> <span class="built_in">Array</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    elements.forEach(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 检测元素是否含有 vanillaTilt 属性</span></span><br><span class="line">        <span class="comment">// 防止元素重复注册</span></span><br><span class="line">        <span class="keyword">if</span> (!(<span class="string">'vanillaTilt'</span> <span class="keyword">in</span> element)) &#123;</span><br><span class="line">            element.vanillaTilt = <span class="keyword">new</span> VanillaTilt(element, settings);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="初始化-setting"><a href="#初始化-setting" class="headerlink" title="初始化 setting"></a>初始化 <code>setting</code></h2><p><code>settings</code> 指定方法</p>
<ul>
<li><p>初始化时，以对象的方式传入初始化函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">VanillaTilt.init(<span class="built_in">document</span>.querySelector(<span class="string">".your-element"</span>), &#123;</span></span><br><span class="line"><span class="undefined">    max: 25,</span></span><br><span class="line"><span class="undefined">    speed: 400</span></span><br><span class="line"><span class="undefined">&#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>以<code>HTML 属性</code>方式指定有关属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-tilt</span> <span class="attr">data-tilt-reverse</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>实现的核心代码 &amp; 解读</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">extendSettings(settings) &#123;</span><br><span class="line">    <span class="comment">// 初始值</span></span><br><span class="line">    <span class="keyword">let</span> defaultSettings = &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> newSettings = &#123;&#125;;</span><br><span class="line">    <span class="comment">// 循环全量的 defaultSettings</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> property <span class="keyword">in</span> defaultSettings) &#123;</span><br><span class="line">        <span class="keyword">if</span> (property <span class="keyword">in</span> settings) &#123;</span><br><span class="line">            <span class="comment">// 通过对象传入 settings；检测用户是否指定对应的属性值</span></span><br><span class="line">            newSettings[property] = settings[property];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>.element.hasAttribute(<span class="string">"data-tilt-"</span> + property)) &#123;</span><br><span class="line">            <span class="comment">// 通过 HTML 属性方式传入属性值</span></span><br><span class="line">            <span class="keyword">let</span> attribute = <span class="keyword">this</span>.element.getAttribute(<span class="string">"data-tilt-"</span> + property);</span><br><span class="line">            <span class="comment">// 这里为啥要使用 try/catch，防止 JSON.parse 解析失败？</span></span><br><span class="line">            <span class="comment">// JSON.parse 解析可能失败的情况，举个栗子</span></span><br><span class="line">            <span class="comment">// 在 HTML 中 这样设置 data-tilt-reverse="" 时；使用 JSON.parse 会报错</span></span><br><span class="line">            <span class="comment">// 但是在这种情况下该框架认为设置的 reverse 值为 true；</span></span><br><span class="line">            <span class="comment">// 同时自己实现了一个 function isSettingTrue 来检测</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 通过 getAttribute 获取的值是 String；使用 JSON.parse 将结果转化为 Javascript 值</span></span><br><span class="line">                newSettings[property] = <span class="built_in">JSON</span>.parse(attribute);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="comment">// JSON.parse 失败， 直接将获取的属性值赋值给新属性值</span></span><br><span class="line">                newSettings[property] = attribute;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 没有指定有关属性，直接使用默认值</span></span><br><span class="line">            newSettings[property] = defaultSettings[property];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newSettings;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="自定义真值检测"><a href="#自定义真值检测" class="headerlink" title="自定义真值检测"></a>自定义真值检测</h2><p>为了同时兼容以上提到的两种 <code>settings</code> 设置方式，本库自定义了一个真值检测函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原因：用户可能指定 data-tilt-reverse="" 方式，本库认为，reverse 值为 true</span></span><br><span class="line">isSettingTrue (data) &#123;</span><br><span class="line">    <span class="keyword">return</span> data == <span class="string">''</span> || data == <span class="literal">true</span> || data == <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用-bind-显示指定this"><a href="#使用-bind-显示指定this" class="headerlink" title="使用 bind 显示指定this"></a>使用 <code>bind</code> 显示指定<code>this</code></h2><p>使用如 <code>this.onMouseEnterBind = this.onMouseEnter.bind(this);</code> 的方法，显示的指定 <code>this</code></p>
<h2 id="三大事件处理函数"><a href="#三大事件处理函数" class="headerlink" title="三大事件处理函数"></a>三大事件处理函数</h2><h3 id="onMouseEnter"><a href="#onMouseEnter" class="headerlink" title="onMouseEnter"></a>onMouseEnter</h3><p>确定元素位置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回元素的大小 &amp;&amp; 相对于视口的位置</span></span><br><span class="line"><span class="comment">// 返回值是一个 DOMRect 对象，这个对象是由该元素的 getClientRects() 方法返回的一组矩形的集合</span></span><br><span class="line"><span class="keyword">const</span> rect = <span class="keyword">this</span>.element.getBoundingClientRect();</span><br></pre></td></tr></table></figure>
<p><img src="https://imgs.sanbaofengs.com/18-5-8/55951300.jpg" alt=""></p>
<p>使用 <code>will-change</code> 进行优化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.element.style.willChange = <span class="string">"transform"</span>;</span><br></pre></td></tr></table></figure>
<p>防抖处理</p>
<p>详情见 <code>setTransition ()</code> 方法</p>
<h3 id="onMouseMove"><a href="#onMouseMove" class="headerlink" title="onMouseMove"></a>onMouseMove</h3><p>这个库的核心代码</p>
<p>使用 <code>requestAnimationFrame</code> 进行节流处理，防止动画触发太过于频繁</p>
<p>两个方法</p>
<ul>
<li>getValue：参数值处理</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">getValues() &#123;</span><br><span class="line">    <span class="comment">// event.clientX/clientY：鼠标到视口左上角的距离</span></span><br><span class="line">    <span class="comment">// 计算得到的 x/y 表示鼠标点击位置占被点击元素的比例</span></span><br><span class="line">    <span class="keyword">let</span> x = (<span class="keyword">this</span>.event.clientX - <span class="keyword">this</span>.left) / <span class="keyword">this</span>.width;</span><br><span class="line">    <span class="keyword">let</span> y = (<span class="keyword">this</span>.event.clientY - <span class="keyword">this</span>.top) / <span class="keyword">this</span>.height;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将 x/y 的值限制在区间 [0, 1] 中</span></span><br><span class="line">    x = <span class="built_in">Math</span>.min(<span class="built_in">Math</span>.max(x, <span class="number">0</span>), <span class="number">1</span>);</span><br><span class="line">    y = <span class="built_in">Math</span>.min(<span class="built_in">Math</span>.max(y, <span class="number">0</span>), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算倾斜值：this.settings.max / 2 - x * this.settings.max 相当于，从中点开始计算</span></span><br><span class="line">    <span class="comment">// 问题：为啥要保留两位小数</span></span><br><span class="line">    <span class="keyword">let</span> tiltX = (<span class="keyword">this</span>.reverse * (<span class="keyword">this</span>.settings.max / <span class="number">2</span> - x * <span class="keyword">this</span>.settings.max)).toFixed(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">let</span> tiltY = (<span class="keyword">this</span>.reverse * (y * <span class="keyword">this</span>.settings.max - <span class="keyword">this</span>.settings.max / <span class="number">2</span>)).toFixed(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 计算角度</span></span><br><span class="line">    <span class="keyword">let</span> angle = <span class="built_in">Math</span>.atan2(<span class="keyword">this</span>.event.clientX - (<span class="keyword">this</span>.left + <span class="keyword">this</span>.width / <span class="number">2</span>), -(<span class="keyword">this</span>.event.clientY - (<span class="keyword">this</span>.top + <span class="keyword">this</span>.height / <span class="number">2</span>))) * (<span class="number">180</span> / <span class="built_in">Math</span>.PI);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        tiltX: tiltX,</span><br><span class="line">        tiltY: tiltY,</span><br><span class="line">        percentageX: x * <span class="number">100</span>,</span><br><span class="line">        percentageY: y * <span class="number">100</span>,</span><br><span class="line">        angle: angle</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>update：更新动画</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">update() &#123;</span><br><span class="line">    <span class="keyword">let</span> values = <span class="keyword">this</span>.getValues();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// perspective：透视；指定观察者到 z=0 平面的距离，使具有三维变换的元素产生透视效果</span></span><br><span class="line">    <span class="keyword">this</span>.element.style.transform = <span class="string">"perspective("</span> + <span class="keyword">this</span>.settings.perspective + <span class="string">"px) "</span> +</span><br><span class="line">        <span class="string">"rotateX("</span> + (<span class="keyword">this</span>.settings.axis === <span class="string">"x"</span> ? <span class="number">0</span> : values.tiltY) + <span class="string">"deg) "</span> +</span><br><span class="line">        <span class="string">"rotateY("</span> + (<span class="keyword">this</span>.settings.axis === <span class="string">"y"</span> ? <span class="number">0</span> : values.tiltX) + <span class="string">"deg) "</span> +</span><br><span class="line">        <span class="string">"scale3d("</span> + <span class="keyword">this</span>.settings.scale + <span class="string">", "</span> + <span class="keyword">this</span>.settings.scale + <span class="string">", "</span> + <span class="keyword">this</span>.settings.scale + <span class="string">")"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.glare) &#123;</span><br><span class="line">        <span class="keyword">this</span>.glareElement.style.transform = <span class="string">`rotate(<span class="subst">$&#123;values.angle&#125;</span>deg) translate(-50%, -50%)`</span>;</span><br><span class="line">        <span class="keyword">this</span>.glareElement.style.opacity = <span class="string">`<span class="subst">$&#123;values.percentageY * <span class="keyword">this</span>.settings[<span class="string">"max-glare"</span>] <span class="regexp">/ 100&#125;`;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    &#125;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    /</span><span class="regexp">/ 问题：这里为啥会有一个事件</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    /</span><span class="regexp">/ 对外暴露</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    this.element.dispatchEvent(new CustomEvent("tiltChange", &#123;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">        "detail": values</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    &#125;));</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp"></span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">    this.updateCall = null;</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="regexp">&#125;</span></span></span></span><br></pre></td></tr></table></figure>
<h3 id="onMouseLeave"><a href="#onMouseLeave" class="headerlink" title="onMouseLeave"></a>onMouseLeave</h3><p>根据配置，将元素是否恢复到原始状态</p>
<h2 id="Tricks"><a href="#Tricks" class="headerlink" title="Tricks"></a>Tricks</h2><ul>
<li>使用 JSON.parse 将获取属性值（字符串）转化为 JavaScript 值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="string">'true'</span>)  <span class="comment">// true (boolean)</span></span><br></pre></td></tr></table></figure>
<p>完整注释版 <a href="https://sanbaofengs.com/slaughter/js/vanillaTilt/vanilla-tilt.js">vanilla-tilt.js</a></p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>27 行核心代码写一个简版的</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$</span> (<span class="params">element</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.querySelector(element);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tilter = $(<span class="string">'#tilt'</span>);</span><br><span class="line"><span class="keyword">const</span> max = <span class="number">35</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doTilt</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> clientX = e.clientX;</span><br><span class="line">    <span class="keyword">const</span> clientY = e.clientY;</span><br><span class="line">    <span class="keyword">const</span> rect = <span class="keyword">this</span>.getBoundingClientRect();</span><br><span class="line">    <span class="keyword">const</span> top = rect.top;</span><br><span class="line">    <span class="keyword">const</span> left = rect.left;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> tiltX = max / <span class="number">2</span> - (clientX - left) / width * max;</span><br><span class="line">    <span class="keyword">const</span> tiltY = (clientY - top) / height * max - max / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.style.transform = <span class="string">`perspective(1000px) rotateX(<span class="subst">$&#123;tiltY&#125;</span>deg) rotateY(<span class="subst">$&#123;tiltX&#125;</span>deg)`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reset</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.style.transform = <span class="string">`perspective(1000px) rotateX(0deg) rotateY(0deg)`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">tilter.addEventListener (<span class="string">'mousemove'</span>, doTilt);</span><br><span class="line">tilter.addEventListener(<span class="string">'mouseleave'</span>, reset);</span><br></pre></td></tr></table></figure>
<p>效果：</p>
<iframe src="https://sanbaofengs.com/slaughter/js/vanillaTilt/myTilt.html" frameborder="1" scrolling="no"> </iframe>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/JS/">JS</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/vanilla-tilt/">vanilla-tilt</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/源码阅读/">源码阅读</a></li></ul></footer></article><div id="comments"></div></main><div id="back-to-top"><i class="icon-arrow-right"></i></div><footer class="foot"><div class="foot-copy"><p class="fooot">&copy; 2017-2018 <a class="link" href="https://github.com/x-bao" target="view_window">San Baofeng</a><a href="http://www.miibeian.gov.cn/" target="view_window" style="color: #fff">（鄂ICP备17002258号-2）</a></p><p class="foot-theme">Powered by <a href="https://hexo.io" target="_blank" class="link">Hexo</a> with Theme <a href="https://github.com/x-bao/hexo-theme-ochuunn" target="_blank" class="link">ochuunn</a></p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
ga('create','UA-80885450-5');
ga('send','pageview');</script><!-- 文章详情页才展示评论--><script src="/js/comment.js"></script><script src="/js/autoScroll.js"></script><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>